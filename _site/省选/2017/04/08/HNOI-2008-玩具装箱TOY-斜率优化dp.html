<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Dy's Home</title>

    <!-- Bootstrap CSS -->
<link href="http://localhost:4000//css/bootstrap.min.css" rel='stylesheet' type='text/css'/>
<link href="http://localhost:4000//css/simple-sidebar.css" rel='stylesheet' type='text/css'/>
<link href="http://localhost:4000//css/font-awesome.min.css" rel='stylesheet' type='text/css'/>
<link href="http://localhost:4000//css/global.css" rel='stylesheet' type='text/css'/>
<link href="http://localhost:4000//css/footer.css" rel='stylesheet' type='text/css'/>

    
    <!--MathJex-->
    <script type="text/x-mathjax-config">
	MathJax.Hub.Config({
  		tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
	});
	</script>
	<script type="text/javascript" async
  		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML">
	</script>
	
	<link href="http://localhost:4000//css/post.css" rel='stylesheet' type="text/css"/>
    <link href="http://localhost:4000//css/md-post-header-collapse.css" rel='stylesheet' type="text/css"/>
    <link href="http://localhost:4000//css/toc.css" rel='stylesheet' type="text/css"/>

</head>
<body>
	
    <div id="wrapper" >
		
	    
<!-- Toggle Button -->
 <a href="#menu-toggle" class="btn btn-outline-link hidden-xs-down" id="menu-toggle">
     <i class="fa fa-bars" aria-hidden="true"></i>
 </a>

 <!-- Sidebar for desktop -->
 <div id="sidebar-wrapper" class="hidden-xs-down">
    <nav class="nav nav-pills flex-sm-row p-3 justify-content-center">
        <a class="flex-sm-fill text-sm-center nav-link active" href="#sidebar-home-content" data-toggle="tab" role="tab" id="home">Home</a>
        <a class="flex-sm-fill text-sm-center nav-link hidden-xl-down" href="#sidebar-toc-content" data-toggle="tab" role="tab" id="toc">Toc</a>
    </nav>
    <div class="tab-content" id=tab-content>
        <div class="tab-pane text-sm-center active" id="sidebar-home-content">
            <img class="site-author-image m-2" itemprop="image" src="https://avatars0.githubusercontent.com/u/20853317?v=3&s=460">
            <div class="text-warning">dy0607</div>
            <ul class="sidebar-nav">
    <li data-toggle="tooltip" data-placement="left" data-original-title="主页">
        <a href="http://localhost:4000//index.html">
            <i class="fa fa-home" aria-hidden="true"></i>
            Home  
        </a>
    </li>
    <li data-toggle="tooltip" data-placement="left" data-original-title="博文">
        <a href="http://localhost:4000//index.html#archives">
            <i class="fa fa-file-archive-o" aria-hidden="true"></i>
            Archives 
            <span class="badge badge-primary">8</span>
        </a>
    </li>
    <li data-toggle="tooltip" data-placement="left" data-original-title="分类">
        <a href="http://localhost:4000//categories.html">
            <i class="fa fa-tags" aria-hidden="true"></i>
            Categories
            <span class="badge badge-primary">3</span>
        </a>
    </li>
    <li data-toggle="tooltip" data-placement="left" data-original-title="关于">
        <a href="http://localhost:4000//about.html" >
            <i class="fa fa-user" aria-hidden="true"></i>
            About
        </a>
    </li>
</ul>

         	
        </div>
        <div class="tab-pane fade text-sm-left" id="sidebar-toc-content">
        </div>
    </div>
    
</div>

<!-- Navbar for xsmall screen  -->
<div class="hidden-sm-up">
    <nav class="navbar navbar-toggleable-md navbar-light bg-faded">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="#">Dy's Home</a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="sidebar-nav">
    <li data-toggle="tooltip" data-placement="left" data-original-title="主页">
        <a href="http://localhost:4000//index.html">
            <i class="fa fa-home" aria-hidden="true"></i>
            Home  
        </a>
    </li>
    <li data-toggle="tooltip" data-placement="left" data-original-title="博文">
        <a href="http://localhost:4000//index.html#archives">
            <i class="fa fa-file-archive-o" aria-hidden="true"></i>
            Archives 
            <span class="badge badge-primary">8</span>
        </a>
    </li>
    <li data-toggle="tooltip" data-placement="left" data-original-title="分类">
        <a href="http://localhost:4000//categories.html">
            <i class="fa fa-tags" aria-hidden="true"></i>
            Categories
            <span class="badge badge-primary">3</span>
        </a>
    </li>
    <li data-toggle="tooltip" data-placement="left" data-original-title="关于">
        <a href="http://localhost:4000//about.html" >
            <i class="fa fa-user" aria-hidden="true"></i>
            About
        </a>
    </li>
</ul>

        </div>
    </nav>
</div>
 
	   <!-- Page Content -->
<div id="page-content-wrapper">
    <div class="container-fluid" id="post-content">
        <div class="row">		   
	   		<div class="pagewidth">
            <div class="col-md-12">
                <div class="page-header">
                    <h1 class="text-danger">
                        HNOI 2008 玩具装箱TOY 斜率优化dp
                    </h1></p>
                    <B>Date: <span class="badge badge-primary">2017-04-08</span></B></p>
                    <B>分类:  </B>
                    
    					<a href="http://localhost:4000//categories.html">
						<span class="badge badge-primary">省选</span></a>&nbsp;
    				
    				<B>|&nbsp;</B>
                    <B>标签:  </B>
                    
    					<a href="http://localhost:4000//categories.html">
						<span class="badge badge-primary">DP</span></a>&nbsp;
    				
    				</p>
                    </p>
                </div>
                <h2 id="description">Description</h2>

<p>　P教授要去看奥运，但是他舍不下他的玩具，于是他决定把所有的玩具运到北京。他使用自己的压缩器进行压缩，其可以将任意物品变成一堆，再放到一种特殊的一维容器中。P教授有编号为1…N的N件玩具，第i件玩具经过压缩后变成一维长度为Ci.为了方便整理，P教授要求在一个一维容器中的玩具编号是连续的。同时如果一个一维容器中有多个玩具，那么两件玩具之间要加入一个单位长度的填充物，形式地说如果将第i件玩具到第j个玩具放到一个容器中，那么容器的长度将为 $x=j-i+\sum_i^jC_k$ 制作容器的费用与容器的长度有关，根据教授研究，如果容器长度为$x$,其制作费用为$(X-L)^2$.其中$L$是一个常量。P教授不关心容器的数目，他可以制作出任意长度的容器，甚至超过L。但他希望费用最小.</p>

<h2 id="input">Input</h2>

<p>第一行输入两个整数N，L.接下来N行输入Ci.1&lt;=N&lt;=50000,1&lt;=L,Ci&lt;=10^7</p>

<h2 id="output">Output</h2>

<p>输出最小费用</p>

<h2 id="solution">Solution</h2>

<p>设$sum[i]$表示$C$的前缀和，则很容易得到$O(n^2)$的转移方程:</p>

<script type="math/tex; mode=display">dp[i] = min\{dp[j] + (sum[i] - sum[j] + i - j - 1 - L) ^ 2\}</script>

<p>为了简化方程，设$g[i] = sum[i] + i, c = L + 1$, 于是转移方程为:</p>

<script type="math/tex; mode=display">dp[i] = min\{dp[j] + (g[i] - g[j] - c) ^ 2\}</script>

<p>考虑两种决策$j &lt; k$，则k比j优，当且仅当:</p>

<script type="math/tex; mode=display">dp[j] + (g[i] - g[j] - c)^2 > dp[k] + (g[i] - g[k] - c)^2</script>

<script type="math/tex; mode=display">g[i] > \frac{dp[k] - dp[j] + (g[k] - c) ^ 2 + (g[j] - c) ^ 2}{2(g[k] - g[j])}</script>

<p>我们记</p>

<script type="math/tex; mode=display">slope(j, k) = \frac{dp[k] - dp[j] + (g[k] - c) ^ 2 + (g[j] - c) ^ 2}{2(g[k] - g[j])}</script>

<p>为j到k的斜率，作为判断哪个决策更优的依据．</p>

<p>由于$g[i]$单增，如果当前k比j优，则之后也必有k比j优，即转移具有决策单调性．那我们就可以维护一个单调队列，其中记录了一些决策点，且相邻元素的的斜率单增．更新$dp[i]$时，只需判断队首的两个元素的斜率是否有$s \ge g[i]$，若是则说明第二个元素作为决策点更优，弹掉队首．然后直接取队首作为决策点更新$dp[i]$，并将i作为决策点插入队尾，但要保持队列中的斜率单调性．</p>

<h2 id="source">Source</h2>

<pre><code class="c++">#include &lt;cstdio&gt;
#include &lt;algorithm&gt;
#include &lt;cstring&gt;
#include &lt;cmath&gt;

#define For(i, j, k) for(int i = j; i &lt;= k; i++)
#define Forr(i, j, k) for(int i = j; i &gt;= k; i--)

const int N = 50010;

typedef long long LL;

LL sum[N], g[N], dp[N], c;
int n, que[N];

inline LL sqr(LL x){
	return x * x;
}

inline LL cx(int l, int r){
	return 2 * (g[r] - g[l]);
}

inline LL cy(int l, int r){
	return dp[r] - dp[l] + sqr(g[r] + c) - sqr(g[l] + c);
}

int main(){
	scanf("%d%lld", &amp;n, &amp;c), ++c;
	For(i, 1, n){
		scanf("%lld", &amp;sum[i]);
		sum[i] += sum[i - 1], g[i] = sum[i] + i;
	}
	int fst = 1, lst = 1;
	que[1] = 0;
	For(i, 1, n){
		while(fst &lt; lst &amp;&amp; g[i] * cx(que[fst], que[fst + 1]) &gt;= 
				cy(que[fst], que[fst + 1])) ++fst;
		int x = que[fst];
		dp[i] = dp[x] + sqr(g[i] - g[x] - c);
		while(fst &lt; lst &amp;&amp; cy(que[lst - 1], que[lst]) * cx(que[lst], i) &gt;=
				cy(que[lst], i) * cx(que[lst - 1], que[lst])) --lst;
		que[++lst] = i;
	}
	printf("%lld\n", dp[n]);
	return 0;
}
</code></pre>

                </p></p>

                <!-- don't delete this div as this is header collapse end identified  -->
                <div id="content-end"></div>
                <div></div>
                </div>
            </div>

        </div>
    </div>
<!-- /#page-content-wrapper -->

	   <div class="row">
    <div class="col-md-12">
        <div id="disqus_thread"></div>
        <script>
          var disqus_config = function () {
            this.page.url = 'https://dy0607.github.io';  
            this.page.identifier = 'https://dy0607.github.io/dy0607.github.io/index.html';
          };
          
          (function() { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          s.src = 'https://dy0607.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</div>

	   <footer class="mt-5 pt-5">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <strong>Credits</strong>
        <table class="table table-sm">
          <tr>
            <td>Theme by:</td>
            <td>Szhshp</td>
          </tr>
          <tr>
            <td>Engine:</td>
            <td>Ruby x Jekyll</td>
          </tr>
          </table>
	  <p class="text-muted">Copyright &copy; dy0607 2017</p>
        </div>

        <div class="col-md-6">
          <strong>Friend Links</strong>
          <table class="table table-sm">
            <tr>
              <td><a href="http://sunshine-cfbsl.com"> Sunshine_cfbsl</a></td>
            </tr>
            <tr>
              <td><a href="http://blog.csdn.net/frods"> SAK</a></td>
            </tr>
            <tr>
              <td><a href="http://blog.csdn.net/miaomiao_ymxl"> MiaoMiao</a></td>
            </tr>
            <tr>
              <td><a href="http://blog.csdn.net/henyouyisiba123"> YYC</a></td>
            </tr>
          </table>
        </div>
      </div>
    </div>  
  </footer>
  
  <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=220 height=52 src="//music.163.com/outchain/player?type=2&id=36897723&auto=1&height=32" style="position: fixed; bottom: 0; left: 30px;"></iframe>


    </div>

    <!-- jQuery first, then Tether, then Bootstrap JS. -->
<script src="http://localhost:4000//js/jquery-3.1.1.min.js"></script>
<script src="http://localhost:4000//js/tether.min.js"></script>
<script src="http://localhost:4000//js/bootstrap.min.js"></script>
    
    <!-- New Highlighter  -->
   <link rel="stylesheet" href="http://localhost:4000//styles/atelier-lakeside-dark.css"/>
	<script src="http://localhost:4000//js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	
	<!-- Old Highlighter : do not remove it or there may be a compile error in post.js -->
   <script src="http://localhost:4000//js/shCore.js" type='text/javascript'></script>

   <!-- Header collapse -->
   <script src="http://localhost:4000//js/md-post-header-collapse.js" type="text/javascript"></script>

   <script src="http://localhost:4000//js/sidebar.js" type="text/javascript"></script>
   <script src="http://localhost:4000//js/post.js" type="text/javascript"></script>
   <script src="http://localhost:4000//js/toc.js" type="text/javascript"></script>


</body>
</html>

